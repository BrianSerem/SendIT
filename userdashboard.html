
<!doctype html>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>USER Dashboard</title>
    <link rel="stylesheet" href="css/dashstyle.css" type="text/css" />
    <link rel="stylesheet" href="css/default.css" type="text/css" />
    <link rel="stylesheet" href="css/tabllestyle.css" type="text/css" />
    <link href="images/senditlogo/senditfav.png" rel="icon" type="image/png">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
</head>

<!doctype html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
      <title>USER Dashboard</title>
      <link rel="stylesheet" href="css/dashstyle.css" type="text/css" />
      <link rel="stylesheet" href="css/default.css" type="text/css" />
      <link rel="stylesheet" href="css/tabllestyle.css" type="text/css" />
      <link href="images/senditlogo/senditfav.png" rel="icon" type="image/png">
      <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
   </head>
   <body>
      <div id="header-wrapper">
         <div id="header" class="container">
            <div id="logo">
                <h1><a href="index.html"><img src="images/senditlogo/senditfav.png"></a></h1>
            </div>
            <div id="menu">
                <ul>
                    <li><a id="nav_home" href="index.html" accesskey="1" title="">HOME</a>
                    </li>
                    <li><a id="nav_home" href="about.html" accesskey="4" title="">About Us</a>
                    </li>
                    <li><a id="logout" href="#" accesskey="4" title="">LOG OUT</a>
                    </li>
                    <li class="current_page_item">
                        <a id="username" href="profile.html" accesskey="4" title=""></a>
                    </li>
                    <li>
                        <a id="nav_profile" href="profile.html"><img src="images/user.png">
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <section id="body" class="width">
        <aside id="sidebar" class="column-left">
            <header>
                <h1><a href="index.html">DASHBOARD</a></h1>
                <h2>Dashboard</h2>
            </header>
            <nav id="mainnav">
                <ul>
                    <li><a id="allparcels" href="#">All PARCELS</a>
                    </li>
                    <li><a id="deliveredparcels" href="#">DELIVERED PARCELS</a>
                    </li>
                    <li><a id="intransitparcels" href="#">IN TRANSIT PARCELS</a>
                    </li>
                    <li><a id="pendingparcels" href="#">PENDIND PARCELS</a>
                    </li>
                    <li><a id="pricing" href="#">PRICING</a>
                    </li>
                    <li><a id="support" href="support.html">SUPPORT</a>
                    </li>
                </ul>
            </nav>
        </aside>
    </section>
    <section id="content" class="column-right">
        <div id="Table">
            <table class="container">
                <div id="displayTable"></div>
            </table>
            </span>
        </div>
        <script src="js/order.js" type="text/javascript"></script>
        <script src="js/main.js" type="text/javascript"></script>
        <script>
            document.getElementById("allparcels").addEventListener("click", getAllUserParcels);

            function getAllUserParcels() {

                let getalluseparcelsurl = `http://127.0.0.1:5000/api/v2/users/${localStorage.user_id}/parcels`

                fetch(getalluseparcelsurl, {
                        method: "GET",
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + localStorage.token
                        }
                    })
                    .then(res => res.json())
                    .then(response => {
                        if (response.status === "success") {
                            console.log(response.message)
                            let parcels = response.message;
                            var col = [];
                            for (var i = 0; i < parcels.length; i++) {
                                for (var key in parcels[i]) {
                                    if (col.indexOf(key) === -1) {
                                        col.push(key);
                                    }
                                }
                            }

                            // CREATE DYNAMIC TABLE.
                            var table = document.createElement("table");

                            // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

                            var tr = table.insertRow(-1); // TABLE ROW.

                            for (var i = 0; i < col.length; i++) {
                                var th = document.createElement("th"); // TABLE HEADER.
                                th.innerHTML = col[i];
                                tr.appendChild(th);
                            }

                            // ADD JSON DATA TO THE TABLE AS ROWS.
                            for (var i = 0; i < parcels.length; i++) {

                                tr = table.insertRow(-1);

                                for (var j = 0; j < col.length; j++) {
                                    var tabCell = tr.insertCell(-1);
                                    tabCell.innerHTML = parcels[i][col[j]];
                                }
                            }

                            // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
                            var divContainer = document.getElementById("displayTable");
                            divContainer.innerHTML = "";
                            divContainer.appendChild(table);
                        }

                          }
                           )
              
                    .catch(error => console.log(error));
            }
        </script>

</body>

</html>

